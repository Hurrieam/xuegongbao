;(async (doc, tools) => {
    const oWrapper = doc.getElementsByClassName('J_wrapper')[0] as HTMLDivElement,
        oLoading = doc.getElementsByClassName('J_loading')[0] as HTMLDivElement,
        oList = oWrapper.getElementsByClassName("J_list")[0] as HTMLDivElement,
        oSearch = oWrapper.getElementsByTagName("input")[0] as HTMLInputElement,
        oNotFound = oWrapper.getElementsByClassName("J_notfound")[0] as HTMLDivElement;

    let data: IPhoneItem[] = [];

    const init = async () => {
        // 1. 创建Header
        tools.createHeader(oWrapper,"电话簿");
        // 2. 绑定事件函数
        oSearch.onchange = onSearch;
        // 3. 获取所有数据
        data = await fetchData();
        // 4. 根据数据条数渲染列表
        renderTable(data);
    }

    // 从服务器获取数据
    const fetchData = async () => {
        oList.style.display = "none";
        try {
            const result = await fetch("/api/phonebook/list?start=0&limit=100");
            const {code, data} = await result.json();
            if (code !== 10000) {
                alert("获取数据失败");
                return;
            }
            return data.items;
        } catch (e) {
            return [];
        } finally {
            oLoading.style.display = "none";
            oList.style.display = "block";
        }
    }

    // 搜索
    const onSearch = () => {
        const value = oSearch.value;
        const result = data.filter(item => item.deptName.indexOf(value) > -1);
        renderTable(result);
    }

    // 渲染列表
    const renderTable = (data: IPhoneItem[]) => {
        // 1. 清空列表
        oList.innerHTML = "";
        oNotFound.innerHTML = "";
        // 2. 渲染列表
        if (data.length === 0) {
            const nullStrElement = doc.createElement("div");
            nullStrElement.innerHTML = `
                <div class="weui-loadmore weui-loadmore_line">
                    <span class="weui-loadmore__tips">暂无数据</span>
                </div>
            `;
            oNotFound.appendChild(nullStrElement);
        } else {
            data.forEach(item => {
                const div = doc.createElement("div");
                div.innerHTML = `
                    <div>
                    <span class="weui-cell__bd" id="js_cell_itl1_bd" aria-hidden="true">
                    <svg t="1651073891758" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2368" width="20" height="20"><path d="M813.907051 64.47136 252.627694 64.47136c-74.503854 0-135.122467 60.618613-135.122467 135.122467l0 66.972321c0 17.225313 13.956873 31.182186 31.182186 31.182186s31.182186-13.956873 31.182186-31.182186l0-66.972321c0-40.114626 32.643468-72.758094 72.758094-72.758094l561.279357 0c40.114626 0 72.758094 32.643468 72.758094 72.758094l0 625.125477c0 40.114626-32.643468 72.758094-72.758094 72.758094L252.627694 897.477398c-40.114626 0-72.758094-32.643468-72.758094-72.758094L179.8696 769.774925c0-17.225313-13.956873-31.182186-31.182186-31.182186s-31.182186 13.956873-31.182186 31.182186l0 54.94438c0 74.503854 60.618613 135.122467 135.122467 135.122467l561.279357 0c74.503854 0 135.122467-60.618613 135.122467-135.122467L949.029518 199.593827C949.029518 125.08895 888.410905 64.47136 813.907051 64.47136z" p-id="2369"></path><path d="M221.445508 653.697209c0-17.225313-13.956873-31.182186-31.182186-31.182186l-83.152838 0c-17.225313 0-31.182186 13.956873-31.182186 31.182186s13.956873 31.182186 31.182186 31.182186l83.152838 0C207.488635 684.879396 221.445508 670.922523 221.445508 653.697209z" p-id="2370"></path><path d="M107.111506 393.845996l83.152838 0c17.225313 0 31.182186-13.956873 31.182186-31.182186 0-17.225313-13.956873-31.182186-31.182186-31.182186l-83.152838 0c-17.225313 0-31.182186 13.956873-31.182186 31.182186C75.92932 379.889123 89.886193 393.845996 107.111506 393.845996z" p-id="2371"></path><path d="M777.709641 547.3276c-17.225313 0-31.182186 13.956873-31.182186 31.182186 0 63.034639-25.670659 110.832248-83.23368 154.986887-13.662161 10.475586-16.240893 30.055526-5.755074 43.717687 6.130627 7.998161 15.398712 12.20088 24.756847 12.20088 6.627954 0 13.296841-2.100848 18.960841-6.445806 73.42836-56.32482 107.635439-121.2976 107.635439-204.460672C808.891827 561.284473 794.934954 547.3276 777.709641 547.3276z" p-id="2372"></path><path d="M427.671383 731.649606c-56.69014-44.823881-80.879052-90.622974-80.879052-153.139819 0-17.225313-13.956873-31.182186-31.182186-31.182186-17.225313 0-31.182186 13.956873-31.182186 31.182186 0 81.446987 33.222659 145.658428 104.569614 202.065112 5.724375 4.527107 12.545734 6.720052 19.315928 6.720052 9.206686 0 18.321274-4.060479 24.482601-11.845793C443.476347 761.938446 441.182095 742.338039 427.671383 731.649606z" p-id="2373"></path><path d="M767.800967 306.142515c-46.327118-54.964846-120.891348-82.83766-221.624587-82.83766-100.723006 0-175.166485 27.872814-221.259266 82.83766-63.014172 75.122955-46.814212 171.644265-46.092781 175.713954 2.680039 15.124466 15.824407 25.761734 30.664394 25.761734 1.807159 0 3.63376-0.162706 5.470595-0.487094 16.9613-3.004427 28.279067-19.173688 25.27464-36.136012-0.121773-0.710175-11.348466-72.535013 32.461319-124.779911 33.689287-40.175001 92.064812-60.546981 173.4811-60.546981 81.182974 0 139.578965 20.260439 173.552731 60.21236 44.682665 52.538587 33.567513 124.677581 33.466206 125.267005-2.913353 16.971533 8.476045 33.090653 25.457812 36.014238 16.951067 2.87242 33.090653-8.485255 36.014238-25.447579C815.356053 477.644541 831.058686 381.215328 767.800967 306.142515z" p-id="2374"></path><path d="M442.720124 437.865559c-17.225313 0-31.182186 13.956873-31.182186 31.182186l0 31.182186c0 17.225313 13.956873 31.182186 31.182186 31.182186s31.182186-13.956873 31.182186-31.182186l0-31.182186C473.90231 451.822432 459.945437 437.865559 442.720124 437.865559z" p-id="2375"></path><path d="M650.600685 437.865559c-17.225313 0-31.182186 13.956873-31.182186 31.182186l0 31.182186c0 17.225313 13.956873 31.182186 31.182186 31.182186 17.225313 0 31.182186-13.956873 31.182186-31.182186l0-31.182186C681.782871 451.822432 667.825998 437.865559 650.600685 437.865559z" p-id="2376"></path><path d="M107.111506 539.362184l83.152838 0c17.225313 0 31.182186-13.956873 31.182186-31.182186 0-17.225313-13.956873-31.182186-31.182186-31.182186l-83.152838 0c-17.225313 0-31.182186 13.956873-31.182186 31.182186C75.92932 525.405311 89.886193 539.362184 107.111506 539.362184z" p-id="2377"></path><path d="M546.370809 666.706501c42.155099 0 72.006987-29.05064 83.000366-46.214555 9.196453-14.363126 5.024433-33.262568-9.206686-42.652426-14.261818-9.419534-33.506115-5.399987-43.088354 8.67866-0.121773 0.183172-12.332886 17.823947-30.705326 17.823947-17.803481 0-29.030174-16.240893-29.822213-17.427928-9.175987-14.392802-28.227901-18.747993-42.753733-9.734712-14.627139 9.095145-19.123546 28.319999-10.038634 42.946115C474.506061 637.422548 503.992629 666.706501 546.370809 666.706501z" p-id="2378"></path></svg>
</span>
                    <span>${item.deptName}</span>
</div>
                    <span>${item.phone}</span>
                `;
                div.className = "weui-cell  weui-cell_access";
                oList.appendChild(div);
            })
        }
    }

    await init();
})(document, tools);